---
- name: Deploy static website using Docker
  hosts: all
  become: yes

  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes

    - name: Install Docker
      apt:
        name: docker.io
        state: present

    - name: Enable and start Docker
      systemd:
        name: docker
        enabled: true
        state: started

    - name: Create website directory
      file:
        path: /opt/website
        state: directory
        owner: ubuntu
        mode: "0755"

    - name: Copy website files from src/
      copy:
        src: ../src/
        dest: /opt/website/
        owner: ubuntu
        mode: "0644"

    - name: Remove old container if exists
      shell: docker rm -f my-static-page || true

    - name: Run Nginx container serving the site
      shell: >
        docker run -d --name my-static-page -p 80:80
        -v /opt/website:/usr/share/nginx/html:ro nginx
